#!/bin/bash

# Pre-commit hook for Flutter project
# Runs linting and formatting checks before commit

echo "🔍 Running pre-commit checks..."

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Change to project root
cd "$(git rev-parse --show-toplevel)/getir_mobile" || exit 1

# 1. Run Flutter Analyze
echo "📊 Running Flutter analyze..."
if ! flutter analyze --no-pub; then
    echo -e "${RED}❌ Flutter analyze failed. Please fix the issues before committing.${NC}"
    exit 1
fi
echo -e "${GREEN}✅ Flutter analyze passed${NC}"

# 2. Run Dart Format Check
echo "🎨 Checking code formatting..."
if ! dart format --set-exit-if-changed lib/ test/; then
    echo -e "${YELLOW}⚠️  Code formatting issues found. Auto-formatting...${NC}"
    dart format lib/ test/
    echo -e "${GREEN}✅ Code formatted. Please review and re-commit.${NC}"
    exit 1
fi
echo -e "${GREEN}✅ Code formatting check passed${NC}"

# 3. Run Tests (optional - can be disabled for faster commits)
# Uncomment to enable test running on commit
# echo "🧪 Running tests..."
# if ! flutter test --no-pub; then
#     echo -e "${RED}❌ Tests failed. Please fix before committing.${NC}"
#     exit 1
# fi
# echo -e "${GREEN}✅ Tests passed${NC}"

echo -e "${GREEN}✅ All pre-commit checks passed!${NC}"
echo "🚀 Proceeding with commit..."

exit 0
