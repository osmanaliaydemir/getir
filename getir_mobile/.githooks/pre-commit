#!/bin/bash

# Pre-commit hook for Flutter project
# Runs linting and formatting checks before commit

echo "ğŸ” Running pre-commit checks..."

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Change to project root
cd "$(git rev-parse --show-toplevel)/getir_mobile" || exit 1

# 1. Run Flutter Analyze
echo "ğŸ“Š Running Flutter analyze..."
if ! flutter analyze --no-pub; then
    echo -e "${RED}âŒ Flutter analyze failed. Please fix the issues before committing.${NC}"
    exit 1
fi
echo -e "${GREEN}âœ… Flutter analyze passed${NC}"

# 2. Run Dart Format Check
echo "ğŸ¨ Checking code formatting..."
if ! dart format --set-exit-if-changed lib/ test/; then
    echo -e "${YELLOW}âš ï¸  Code formatting issues found. Auto-formatting...${NC}"
    dart format lib/ test/
    echo -e "${GREEN}âœ… Code formatted. Please review and re-commit.${NC}"
    exit 1
fi
echo -e "${GREEN}âœ… Code formatting check passed${NC}"

# 3. Run Tests (optional - can be disabled for faster commits)
# Uncomment to enable test running on commit
# echo "ğŸ§ª Running tests..."
# if ! flutter test --no-pub; then
#     echo -e "${RED}âŒ Tests failed. Please fix before committing.${NC}"
#     exit 1
# fi
# echo -e "${GREEN}âœ… Tests passed${NC}"

echo -e "${GREEN}âœ… All pre-commit checks passed!${NC}"
echo "ğŸš€ Proceeding with commit..."

exit 0
